import{ay as Q,I as X,N as oe,d as R,K as pe,a5 as ne,l as K,e as k,E as ae,r as x,o as r,c as w,b as a,t as v,a as s,a6 as $e,x as p,h as c,z as j,j as M,g as E,H as Z,au as ye,M as we,P as W,p as U,q as Y,aI as me,am as ee,aA as Be,v as re,F as H,i as J,R as le,aK as Ie,ar as fe,a8 as Se,aL as Te,n as G,O as Pe,aM as ke,aN as Ce,ad as Me,u as De,L as Ve,f as xe,w as ge,J as je}from"./main.b57b9d3d.js";import{D as qe,d as Ae}from"./DragIcon.73e1bbb2.js";import{_ as Ee}from"./SelectNotePopup.1a80bc37.js";const Le={class:"flex items-center justify-between mb-3"},Oe={class:"flex items-center text-base",style:{flex:"4"}},Ue={class:"pr-2 mb-0",align:"right"},ze={class:"absolute left-3.5"},Ne={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Fe={class:"text-sm text-right",style:{flex:"3"}},Ye={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Ge={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:_}){const e=t,o=_,I=Q(),f=X(),d=oe(),S=R(null),T=pe({...e.taxData});ne("utils");const{t:y}=K(),D=k(()=>I.taxTypes.map(g=>({...g})).map(g=>(e.taxes.find(n=>n.tax_type_id===g.id)?g.disabled=!0:g.disabled=!1,g))),V=k(()=>T.compound_tax&&e.discountedTotal?(e.discountedTotal+e.totalTax)*T.percent/100:e.discountedTotal&&T.percent?e.discountedTotal*T.percent/100:0);ae(()=>e.discountedTotal,()=>{i()}),ae(()=>e.totalTax,()=>{i()}),e.taxData.tax_type_id>0&&(S.value=I.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),i();function q(m){T.percent=m.percent,T.tax_type_id=m.id,T.compound_tax=m.compound_tax,T.name=m.name,i()}function i(){T.tax_type_id!==0&&o("update",{index:e.index,item:{...T,amount:V.value}})}function u(){let m={itemIndex:e.itemIndex,taxIndex:e.index};f.openModal({title:y("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function l(m){e.store.$patch(g=>{g[e.storeProp].items[e.itemIndex].taxes.splice(m,1)})}return(m,g)=>{const b=x("BaseIcon"),n=x("BaseMultiselect"),B=x("BaseFormatMoney");return r(),w("div",Le,[a("div",Oe,[a("label",Ue,v(m.$t("invoices.item.tax")),1),s(n,{modelValue:S.value,"onUpdate:modelValue":[g[0]||(g[0]=P=>S.value=P),g[1]||(g[1]=P=>q(P))],"value-prop":"id",options:D.value,placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},$e({singlelabel:c(({value:P})=>[a("div",ze,v(P.name)+" - "+v(P.percent)+" % ",1)]),option:c(({option:P})=>[j(v(P.name)+" - "+v(P.percent)+" % ",1)]),_:2},[p(d).hasAbilities(t.ability)?{name:"action",fn:c(()=>[a("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:u},[s(b,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),a("label",Ne,v(m.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),g[3]||(g[3]=a("br",null,null,-1))]),a("div",Fe,[s(B,{amount:V.value,currency:t.currency},null,8,["amount","currency"])]),a("div",Ye,[t.taxes.length&&t.index!==t.taxes.length-1?(r(),M(b,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:g[2]||(g[2]=P=>l(t.index))})):E("",!0)])])}}},Re={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},We={colspan:"5",class:"p-0 text-left align-top"},Xe={class:"w-full"},Ke={key:0,style:{width:"15%","min-width":"160px"}},He={class:"px-5 py-4 text-left align-top"},Je={class:"flex justify-start"},Qe={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Ze={class:"px-5 py-4 text-right align-top"},et={class:"px-5 py-4 text-left align-top"},tt={class:"flex flex-col"},st={class:"flex-auto flex-fill bd-highlight"},at={class:"relative w-full"},ot={key:0,class:"px-5 py-4 text-left align-top"},nt={class:"flex flex-col"},rt={class:"flex",style:{width:"120px"},role:"group"},lt={class:"flex items-center"},it={class:"px-5 py-4 text-right align-top"},dt={class:"flex items-center justify-end text-sm"},ut={class:"flex items-center justify-center w-6 h-10 mx-2"},ct={key:0},mt={colspan:"4",class:"px-5 py-4 text-left align-top"},pt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:_}){const e=t,o=Z(),I=ye();we();const{t:f}=K(),d=k({get:()=>e.itemData.quantity,set:h=>{A("quantity",parseFloat(h))}}),S=k({get:()=>{const h=e.itemData.price;return parseFloat(h)>0?h/100:h},set:h=>{if(parseFloat(h)>0){let $=Math.round(h*100);A("price",$)}else A("price",h)}}),T=k(()=>e.itemData.price*e.itemData.quantity),y=k({get:()=>e.itemData.discount,set:h=>{e.itemData.discount_type==="percentage"?A("discount_val",T.value*h/100):A("discount_val",Math.round(h*100)),A("discount",h)}}),D=k(()=>T.value-e.itemData.discount_val),V=k(()=>e.currency?e.currency:o.selectedCompanyCurrency),q=k(()=>e.store[e.storeProp].items.length!=1),i=k(()=>Math.round(W.exports.sumBy(e.itemData.taxes,function(h){return h.compound_tax?0:h.amount}))),u=k(()=>Math.round(W.exports.sumBy(e.itemData.taxes,function(h){return h.compound_tax?h.amount:0}))),l=k(()=>i.value+u.value),m={name:{required:U.withMessage(f("validation.required"),Y)},quantity:{required:U.withMessage(f("validation.required"),Y),minValue:U.withMessage(f("validation.qty_must_greater_than_zero"),me(0)),maxLength:U.withMessage(f("validation.amount_maxlength"),ee(20))},price:{required:U.withMessage(f("validation.required"),Y),minValue:U.withMessage(f("validation.number_length_minvalue"),me(1)),maxLength:U.withMessage(f("validation.price_maxlength"),ee(20))},discount_val:{between:U.withMessage(f("validation.discount_maxlength"),Be(0,k(()=>T.value)))},description:{maxLength:U.withMessage(f("validation.notes_maxlength"),ee(65e3))}},g=re(m,k(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function b(h){e.store.$patch(O=>{O[e.storeProp].items[e.index].taxes[h.index]=h.item});let $=e.itemData.taxes[e.itemData.taxes.length-1];($==null?void 0:$.tax_type_id)!==0&&e.store.$patch(O=>{O[e.storeProp].items[e.index].taxes.push({...Ie,id:fe.raw()})}),C()}function n(h){A("name",h)}function B(h){e.store.$patch($=>{if($[e.storeProp].items[e.index].name=h.name,$[e.storeProp].items[e.index].price=h.price,$[e.storeProp].items[e.index].item_id=h.id,$[e.storeProp].items[e.index].description=h.description,h.unit&&($[e.storeProp].items[e.index].unit_name=h.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&h.taxes){let O=0;h.taxes.forEach(F=>{b({index:O,item:{...F}}),O++})}$[e.storeProp].exchange_rate&&($[e.storeProp].items[e.index].price/=$[e.storeProp].exchange_rate)}),I.fetchItems(),C()}function P(){e.itemData.discount_type!=="fixed"&&(A("discount_val",Math.round(e.itemData.discount*100)),A("discount_type","fixed"))}function L(){e.itemData.discount_type!=="percentage"&&(A("discount_val",T.value*e.itemData.discount/100),A("discount_type","percentage"))}function C(){var O,F;let h=(F=(O=e.store[e.storeProp])==null?void 0:O.items[e.index])==null?void 0:F.taxes;h||(h=[]);let $={...e.store[e.storeProp].items[e.index],index:e.index,total:D.value,sub_total:T.value,totalSimpleTax:i.value,totalCompoundTax:u.value,totalTax:l.value,tax:l.value,taxes:[...h]};e.store.updateItem($)}function A(h,$){e.store.$patch(O=>{O[e.storeProp].items[e.index][h]=$}),C()}return(h,$)=>{const O=x("BaseItemSelect"),F=x("BaseInput"),z=x("BaseMoney"),ie=x("BaseIcon"),_e=x("BaseButton"),de=x("BaseDropdownItem"),ve=x("BaseDropdown"),ue=x("BaseContentPlaceholdersText"),ce=x("BaseContentPlaceholders"),be=x("BaseFormatMoney");return r(),w("tr",Re,[a("td",We,[a("table",Xe,[a("colgroup",null,[$[6]||($[6]=a("col",{style:{width:"40%","min-width":"280px"}},null,-1)),$[7]||($[7]=a("col",{style:{width:"10%","min-width":"120px"}},null,-1)),$[8]||($[8]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(r(),w("col",Ke)):E("",!0),$[9]||($[9]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),a("tbody",null,[a("tr",null,[a("td",He,[a("div",Je,[a("div",Qe,[s(qe)]),s(O,{type:"Invoice",item:t.itemData,invalid:p(g).name.$error,"invalid-description":p(g).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:n,onSelect:B},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),a("td",Ze,[s(F,{modelValue:d.value,"onUpdate:modelValue":$[0]||($[0]=N=>d.value=N),invalid:p(g).quantity.$error,"content-loading":t.loading,type:"number",small:"",min:"0",step:"any",onChange:$[1]||($[1]=N=>C()),onInput:$[2]||($[2]=N=>p(g).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),a("td",et,[a("div",tt,[a("div",st,[a("div",at,[(r(),M(z,{key:V.value,modelValue:S.value,"onUpdate:modelValue":$[3]||($[3]=N=>S.value=N),invalid:p(g).price.$error,"content-loading":t.loading,currency:V.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(r(),w("td",ot,[a("div",nt,[a("div",rt,[s(F,{modelValue:y.value,"onUpdate:modelValue":$[4]||($[4]=N=>y.value=N),invalid:p(g).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(ve,{position:"bottom-end"},{activator:c(()=>[s(_e,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[a("span",lt,[j(v(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),s(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[s(de,{onClick:P},{default:c(()=>[j(v(h.$t("general.fixed")),1)]),_:1}),s(de,{onClick:L},{default:c(()=>[j(v(h.$t("general.percentage")),1)]),_:1})]),_:1})])])])):E("",!0),a("td",it,[a("div",dt,[a("span",null,[t.loading?(r(),M(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),M(be,{key:1,amount:D.value,currency:V.value},null,8,["amount","currency"]))]),a("div",ut,[q.value?(r(),M(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:$[5]||($[5]=N=>t.store.removeItem(t.index))})):E("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(r(),w("tr",ct,[$[10]||($[10]=a("td",{class:"px-5 py-4 text-left align-top"},null,-1)),a("td",mt,[t.loading?(r(),M(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(!0),w(H,{key:1},J(t.itemData.taxes,(N,he)=>(r(),M(Ge,{key:N.id,index:he,"item-index":t.index,"tax-data":N,taxes:t.itemData.taxes,"discounted-total":D.value,"total-tax":i.value,total:T.value,currency:t.currency,"update-items":C,ability:p(le).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:y.value,onUpdate:b},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):E("",!0)])])])])}}},yt={class:"text-center item-table min-w-full"},ft={key:0,style:{width:"15%","min-width":"160px"}},xt={class:"bg-white border border-gray-200 border-solid"},gt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},_t={key:1,class:"pl-7"},vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},bt={key:1},ht={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},$t={key:1},wt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Bt={key:1},It={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},St={key:1,class:"pr-10 column-heading"},Cs={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const _=t,e=Z(),o=k(()=>_.currency?_.currency:e.selectedCompanyCurrency);return(I,f)=>{const d=x("BaseContentPlaceholdersText"),S=x("BaseContentPlaceholders"),T=x("BaseIcon");return r(),w(H,null,[a("table",yt,[a("colgroup",null,[f[2]||(f[2]=a("col",{style:{width:"40%","min-width":"280px"}},null,-1)),f[3]||(f[3]=a("col",{style:{width:"10%","min-width":"120px"}},null,-1)),f[4]||(f[4]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(r(),w("col",ft)):E("",!0),f[5]||(f[5]=a("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),a("thead",xt,[a("tr",null,[a("th",gt,[t.isLoading?(r(),M(S,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("span",_t,v(I.$tc("items.item",2)),1))]),a("th",vt,[t.isLoading?(r(),M(S,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("span",bt,v(I.$t("invoices.item.quantity")),1))]),a("th",ht,[t.isLoading?(r(),M(S,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("span",$t,v(I.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(r(),w("th",wt,[t.isLoading?(r(),M(S,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("span",Bt,v(I.$t("invoices.item.discount")),1))])):E("",!0),a("th",It,[t.isLoading?(r(),M(S,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("span",St,v(I.$t("invoices.item.amount")),1))])])]),s(p(Ae),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":f[0]||(f[0]=y=>t.store[t.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:y,index:D})=>[(r(),M(pt,{key:y.id,index:D,"item-data":y,loading:t.isLoading,currency:o.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),a("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:f[1]||(f[1]=(...y)=>t.store.addItem&&t.store.addItem(...y))},[s(T,{name:"PlusCircleIcon",class:"mr-2"}),j(" "+v(I.$t("general.add_new_item")),1)])],64)}}},Tt={class:"flex items-center justify-between w-full mt-2 text-sm"},Pt={class:"font-semibold leading-5 text-gray-500 uppercase"},kt={class:"flex items-center justify-center text-lg text-black"},Ct={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:_}){const e=t,o=_;ne("$utils");const I=k(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Se(()=>{e.store.getSubtotalWithDiscount&&f(),e.store.getTotalSimpleTax&&f()});function f(){o("update",{...e.tax,amount:I.value})}return(d,S)=>{const T=x("BaseFormatMoney"),y=x("BaseIcon");return r(),w("div",Tt,[a("label",Pt,v(t.tax.name)+" ("+v(t.tax.percent)+" %) ",1),a("label",kt,[s(T,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),s(y,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:S[0]||(S[0]=D=>d.$emit("remove",t.tax.id))})])])}}},Mt={class:"w-full mt-4 tax-select"},Dt={class:"relative w-full max-w-md px-4"},Vt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},jt={class:"relative bg-white"},qt={class:"relative p-4"},At={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Et=["onClick"],Lt={class:"flex justify-between px-2"},Ot={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Ut={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},zt={key:1,class:"flex justify-center p-5 text-gray-400"},Nt={class:"text-base text-gray-500 cursor-pointer"},Ft={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Yt={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:_}){const e=t,o=_,I=X(),f=Q(),d=oe(),{t:S}=K(),T=R(null),y=k(()=>T.value?f.taxTypes.filter(function(i){return i.name.toLowerCase().indexOf(T.value.toLowerCase())!==-1}):f.taxTypes),D=k(()=>e.store[e.storeProp].taxes);function V(i,u){o("select:taxType",{...i}),u()}function q(){I.openModal({title:S("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:i=>o("select:taxType",i)})}return(i,u)=>{const l=x("BaseIcon"),m=x("BaseInput");return r(),w("div",Mt,[s(p(Ce),{class:"relative"},{default:c(({isOpen:g})=>[s(p(Te),{class:G([g?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[s(l,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+v(i.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),a("div",Dt,[s(Pe,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[s(p(ke),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:b})=>[a("div",Vt,[a("div",jt,[a("div",qt,[s(m,{modelValue:T.value,"onUpdate:modelValue":u[0]||(u[0]=n=>T.value=n),placeholder:i.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),y.value.length>0?(r(),w("div",At,[(r(!0),w(H,null,J(y.value,(n,B)=>(r(),w("div",{key:B,class:G([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":D.value.find(P=>P.tax_type_id===n.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:P=>V(n,b)},[a("div",Lt,[a("label",Ot,v(n.name),1),a("label",Ut,v(n.percent)+" % ",1)])],10,Et))),128))])):(r(),w("div",zt,[a("label",Nt,v(i.$t("general.no_tax_found")),1)]))]),p(d).hasAbilities(p(le).CREATE_TAX_TYPE)?(r(),w("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:q},[s(l,{name:"CheckCircleIcon",class:"text-primary-400"}),a("label",Ft,v(i.$t("estimates.add_new_tax")),1)])):E("",!0)])]),_:1})]),_:1})])]),_:1})])}}},Gt={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},Rt={class:"flex items-center justify-between w-full"},Wt={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Xt={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Kt={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},Ht={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Jt={key:0,class:"flex items-center justify-between w-full mt-2"},Qt={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Zt={key:3,class:"flex",style:{width:"140px"},role:"group"},es={class:"flex items-center"},ts={key:1},ss={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},as={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},os={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Ms={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const _=R(null),e=t;ne("$utils");const o=Z(),I=k({get:()=>e.store[e.storeProp].discount,set:i=>{e.store[e.storeProp].discount_type==="percentage"?e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*i/100):e.store[e.storeProp].discount_val=Math.round(i*100),e.store[e.storeProp].discount=i}}),f=k({get:()=>e.store[e.storeProp].taxes,set:i=>{e.store.$patch(u=>{u[e.storeProp].taxes=i})}}),d=k(()=>{let i=[];return e.store[e.storeProp].items.forEach(u=>{u.taxes&&u.taxes.forEach(l=>{let m=i.find(g=>g.tax_type_id===l.tax_type_id);m?m.amount+=l.amount:l.tax_type_id&&i.push({tax_type_id:l.tax_type_id,amount:l.amount,percent:l.percent,name:l.name})})}),i}),S=k(()=>e.currency?e.currency:o.selectedCompanyCurrency);function T(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function y(){e.store[e.storeProp].discount_type!=="percentage"&&(e.store[e.storeProp].discount_val=e.store.getSubTotal*e.store[e.storeProp].discount/100,e.store[e.storeProp].discount_type="percentage")}function D(i){let u=0;i.compound_tax&&e.store.getSubtotalWithDiscount?u=Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*i.percent/100):e.store.getSubtotalWithDiscount&&i.percent&&(u=Math.round(e.store.getSubtotalWithDiscount*i.percent/100));let l={...le,id:fe.raw(),name:i.name,percent:i.percent,compound_tax:i.compound_tax,tax_type_id:i.id,amount:u};e.store.$patch(m=>{m[e.storeProp].taxes.push({...l})})}function V(i){const u=e.store[e.storeProp].taxes.find(l=>l.id===i.id);u&&Object.assign(u,{...i})}function q(i){const u=e.store[e.storeProp].taxes.findIndex(l=>l.id===i);e.store.$patch(l=>{l[e.storeProp].taxes.splice(u,1)})}return(i,u)=>{const l=x("BaseContentPlaceholdersText"),m=x("BaseContentPlaceholders"),g=x("BaseFormatMoney"),b=x("BaseInput"),n=x("BaseIcon"),B=x("BaseButton"),P=x("BaseDropdownItem"),L=x("BaseDropdown");return r(),w("div",Gt,[a("div",Rt,[t.isLoading?(r(),M(m,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("label",Wt,v(i.$t("estimates.sub_total")),1)),t.isLoading?(r(),M(m,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("label",Xt,[s(g,{amount:t.store.getSubTotal,currency:S.value},null,8,["amount","currency"])]))]),(r(!0),w(H,null,J(d.value,C=>(r(),w("div",{key:C.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(r(),M(m,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(r(),w("label",Kt,v(C.name)+" - "+v(C.percent)+"% ",1)):E("",!0),t.isLoading?(r(),M(m,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(r(),w("label",Ht,[s(g,{amount:C.amount,currency:S.value},null,8,["amount","currency"])])):E("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(r(),w("div",Jt,[t.isLoading?(r(),M(m,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("label",Qt,v(i.$t("estimates.discount")),1)),t.isLoading?(r(),M(m,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(),w("div",Zt,[s(b,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=C=>I.value=C),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(L,{position:"bottom-end"},{activator:c(()=>[s(B,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[a("span",es,[j(v(t.store[t.storeProp].discount_type=="fixed"?S.value.symbol:"%")+" ",1),s(n,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[s(P,{onClick:T},{default:c(()=>[j(v(i.$t("general.fixed")),1)]),_:1}),s(P,{onClick:y},{default:c(()=>[j(v(i.$t("general.percentage")),1)]),_:1})]),_:1})]))])):E("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(r(),w("div",ts,[(r(!0),w(H,null,J(f.value,(C,A)=>(r(),M(Ct,{key:C.id,index:A,tax:C,taxes:f.value,currency:t.currency,store:t.store,onRemove:q,onUpdate:V},null,8,["index","tax","taxes","currency","store"]))),128))])):E("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(r(),w("div",{key:2,ref_key:"taxModal",ref:_,class:"float-right pt-2 pb-4"},[s(Yt,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":D},null,8,["store-prop","store","type"])],512)):E("",!0),a("div",ss,[t.isLoading?(r(),M(m,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("label",as,v(i.$t("estimates.total"))+" "+v(i.$t("estimates.amount"))+":",1)),t.isLoading?(r(),M(m,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),w("label",os,[s(g,{amount:t.store.getTotal,currency:S.value},null,8,["amount","currency"])]))])])}}},ns={class:"flex text-gray-800 font-medium text-sm mb-2"},Ds={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const _=t,e=X(),{t:o}=K();function I(){let f="";_.storeProp=="newEstimate"?f=o("estimates.mark_as_default_estimate_template_description"):_.storeProp=="newInvoice"&&(f=o("invoices.mark_as_default_invoice_template_description")),e.openModal({title:o("general.choose_template"),componentName:"SelectTemplate",data:{templates:_.store.templates,store:_.store,storeProp:_.storeProp,isMarkAsDefault:_.isMarkAsDefault,markAsDefaultDescription:f}})}return(f,d)=>{const S=x("BaseIcon"),T=x("BaseButton");return r(),w("div",null,[a("label",ns,[j(v(f.$t("general.select_template"))+" ",1),d[0]||(d[0]=a("span",{class:"text-sm text-red-500"}," *",-1))]),s(T,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:I},{right:c(y=>[s(S,{name:"PencilIcon",class:G(y.class)},null,8,["class"])]),default:c(()=>[j(" "+v(t.store[t.storeProp].template_name),1)]),_:1})])}}},rs={class:"mb-6"},ls={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},is={class:"text-gray-800 font-medium mb-4 text-sm"},Vs={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const _=t;function e(o){_.store[_.storeProp].notes=""+o.notes}return(o,I)=>{const f=x("BaseCustomInput");return r(),w("div",rs,[a("div",ls,[s(Ee,{type:t.type,onSelect:e},null,8,["type"])]),a("label",is,v(o.$t("invoices.notes")),1),s(f,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":I[0]||(I[0]=d=>t.store[t.storeProp].notes=d),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},ds={class:"flex justify-between w-full"},us={class:"px-8 py-8 sm:p-6"},cs={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ms=["onClick"],ps=["src","alt"],ys=["alt","src"],fs={key:1,class:"z-0 flex ml-3 pt-5"},xs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},js={__name:"SelectTemplateModal",setup(t){const _=X(),e=oe(),o=R(""),I=k(()=>_.active&&_.componentName==="SelectTemplate"),f=k(()=>_.title);function d(){_.data.store[_.data.storeProp].template_name?o.value=_.data.store[_.data.storeProp].template_name:o.value=_.data.templates[0]}async function S(){await _.data.store.setTemplate(o.value),!_.data.store.isEdit&&_.data.isMarkAsDefault&&(_.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:o.value}}):_.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:o.value}})),y()}function T(){return new URL("/build/img/tick.png",self.location)}function y(){_.closeModal(),setTimeout(()=>{_.$reset()},300)}return(D,V)=>{const q=x("BaseIcon"),i=x("BaseCheckbox"),u=x("BaseButton"),l=x("BaseModal");return r(),M(l,{show:I.value,onClose:y,onOpen:d},{header:c(()=>[a("div",ds,[j(v(f.value)+" ",1),s(q,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[a("div",us,[p(_).data?(r(),w("div",cs,[(r(!0),w(H,null,J(p(_).data.templates,(m,g)=>(r(),w("div",{key:g,class:G([{"border border-solid border-primary-500":o.value===m.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:b=>o.value=m.name},[a("img",{src:m.path,alt:m.name,class:"w-full min-h-[100px]"},null,8,ps),o.value===m.name?(r(),w("img",{key:0,alt:m.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:T()},null,8,ys)):E("",!0),a("span",{class:G(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":o.value===m.name,"text-gray-600":o.value!=m.name}])},v(m.name),3)],10,ms))),128))])):E("",!0),p(_).data.store.isEdit?E("",!0):(r(),w("div",fs,[s(i,{modelValue:p(_).data.isMarkAsDefault,"onUpdate:modelValue":V[0]||(V[0]=m=>p(_).data.isMarkAsDefault=m),"set-initial-value":!1,variant:"primary",label:D.$t("general.mark_as_default"),description:p(_).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),a("div",xs,[s(u,{class:"mr-3",variant:"primary-outline",onClick:y},{default:c(()=>[j(v(D.$t("general.cancel")),1)]),_:1}),s(u,{variant:"primary",onClick:V[1]||(V[1]=m=>S())},{left:c(m=>[s(q,{name:"SaveIcon",class:G(m.class)},null,8,["class"])]),default:c(()=>[j(" "+v(D.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},gs={class:"flex justify-between w-full"},_s={class:"item-modal"},vs={class:"px-8 py-8 sm:p-6"},bs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},qs={__name:"ItemModal",emits:["newItem"],setup(t,{emit:_}){const e=X(),o=ye(),I=Z(),f=Q();Me(),De();const{t:d}=K(),S=R(!1),T=R(I.selectedCompanySettings.tax_per_item),y=k(()=>e.active&&e.componentName==="ItemModal"),D=k({get:()=>o.currentItem.price/100,set:b=>{o.currentItem.price=Math.round(b*100)}}),V=k({get:()=>o.currentItem.taxes.map(b=>{if(b)return{...b,tax_type_id:b.id,tax_name:b.name+" ("+b.percent+"%)"}}),set:b=>{o.$patch(n=>{n.currentItem.taxes=b})}}),q=k(()=>T.value==="YES"),i={name:{required:U.withMessage(d("validation.required"),Y),minLength:U.withMessage(d("validation.name_min_length",{count:3}),Ve(3))},description:{maxLength:U.withMessage(d("validation.description_maxlength",{count:255}),ee(255))}},u=re(i,k(()=>o.currentItem)),l=k(()=>f.taxTypes.map(b=>({...b,tax_name:b.name+" ("+b.percent+"%)"})));xe(()=>{u.value.$reset(),o.fetchItemUnits({limit:"all"})});async function m(){if(u.value.$touch(),u.value.$invalid)return!0;let b={...o.currentItem,taxes:o.currentItem.taxes.map(B=>({tax_type_id:B.id,amount:D.value*B.percent/100,percent:B.percent,name:B.name,collective_tax:0}))};S.value=!0,await(o.isEdit?o.updateItem:o.addItem)(b).then(B=>{S.value=!1,B.data.data&&e.data&&e.refreshData(B.data.data),g()})}function g(){e.closeModal(),setTimeout(()=>{o.resetCurrentItem(),e.$reset(),u.value.$reset()},300)}return(b,n)=>{const B=x("BaseIcon"),P=x("BaseInput"),L=x("BaseInputGroup"),C=x("BaseMoney"),A=x("BaseMultiselect"),h=x("BaseTextarea"),$=x("BaseInputGrid"),O=x("BaseButton"),F=x("BaseModal");return r(),M(F,{show:y.value,onClose:g},{header:c(()=>[a("div",gs,[j(v(p(e).title)+" ",1),s(B,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:g})])]),default:c(()=>[a("div",_s,[a("form",{action:"",onSubmit:ge(m,["prevent"])},[a("div",vs,[s($,{layout:"one-column"},{default:c(()=>[s(L,{label:b.$t("items.name"),required:"",error:p(u).name.$error&&p(u).name.$errors[0].$message},{default:c(()=>[s(P,{modelValue:p(o).currentItem.name,"onUpdate:modelValue":n[0]||(n[0]=z=>p(o).currentItem.name=z),type:"text",invalid:p(u).name.$error,onInput:n[1]||(n[1]=z=>p(u).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(L,{label:b.$t("items.price")},{default:c(()=>[(r(),M(C,{key:p(I).selectedCompanyCurrency,modelValue:D.value,"onUpdate:modelValue":n[2]||(n[2]=z=>D.value=z),currency:p(I).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(L,{label:b.$t("items.unit")},{default:c(()=>[s(A,{modelValue:p(o).currentItem.unit_id,"onUpdate:modelValue":n[3]||(n[3]=z=>p(o).currentItem.unit_id=z),label:"name",options:p(o).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:b.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),q.value?(r(),M(L,{key:0,label:b.$t("items.taxes")},{default:c(()=>[s(A,{modelValue:V.value,"onUpdate:modelValue":n[4]||(n[4]=z=>V.value=z),options:l.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):E("",!0),s(L,{label:b.$t("items.description"),error:p(u).description.$error&&p(u).description.$errors[0].$message},{default:c(()=>[s(h,{modelValue:p(o).currentItem.description,"onUpdate:modelValue":n[5]||(n[5]=z=>p(o).currentItem.description=z),rows:"4",cols:"50",invalid:p(u).description.$error,onInput:n[6]||(n[6]=z=>p(u).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),a("div",bs,[s(O,{class:"mr-3",variant:"primary-outline",type:"button",onClick:g},{default:c(()=>[j(v(b.$t("general.cancel")),1)]),_:1}),s(O,{loading:S.value,disabled:S.value,variant:"primary",type:"submit"},{left:c(z=>[s(B,{name:"SaveIcon",class:G(z.class)},null,8,["class"])]),default:c(()=>[j(" "+v(p(o).isEdit?b.$t("general.update"):b.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},hs={class:"flex justify-between w-full"},$s={class:"flex flex-col"},ws={class:"text-sm text-gray-500 mt-1"},Bs={class:"p-4 sm:p-6"},Is={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ss={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:_}){const e=X();je();const o=pe({state:"",city:"",address_street_1:"",zip:""}),I=R(!1),f=Q(),{t:d}=K(),S=k(()=>e.active&&e.componentName==="TaxationAddressModal"),T=k(()=>({state:{required:U.withMessage(d("validation.required"),Y)},city:{required:U.withMessage(d("validation.required"),Y)},address_street_1:{required:U.withMessage(d("validation.required"),Y)},zip:{required:U.withMessage(d("validation.required"),Y)}})),y=re(T,k(()=>o));async function D(){if(y.value.$touch(),y.value.$invalid)return!0;let u={address:o};e.id&&(u.customer_id=e.id),o.address_street_1=o.address_street_1.replace(/(\r\n|\n|\r)/gm,""),I.value=!0,await f.fetchSalesTax(u).then(l=>{I.value=!1,V("addTax",l.data.data),i()}).catch(l=>{I.value=!1})}const V=_;function q(){var u,l,m,g;o.state=(u=e==null?void 0:e.data)==null?void 0:u.state,o.city=(l=e==null?void 0:e.data)==null?void 0:l.city,o.address_street_1=(m=e==null?void 0:e.data)==null?void 0:m.address_street_1,o.zip=(g=e==null?void 0:e.data)==null?void 0:g.zip}function i(){e.closeModal()}return(u,l)=>{const m=x("BaseIcon"),g=x("BaseInput"),b=x("BaseInputGroup"),n=x("BaseTextarea"),B=x("BaseInputGrid"),P=x("BaseButton"),L=x("BaseModal");return r(),M(L,{show:S.value,onClose:i,onOpen:q},{header:c(()=>[a("div",hs,[a("div",$s,[j(v(p(e).title)+" ",1),a("p",ws,v(p(e).content),1)]),s(m,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:i})])]),default:c(()=>[a("form",{onSubmit:ge(D,["prevent"])},[a("div",Bs,[s(B,{layout:"one-column"},{default:c(()=>[s(b,{required:"",error:p(y).state.$error&&p(y).state.$errors[0].$message,label:u.$t("customers.state")},{default:c(()=>[s(g,{modelValue:o.state,"onUpdate:modelValue":l[0]||(l[0]=C=>o.state=C),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:p(y).state.$error,onInput:l[1]||(l[1]=C=>p(y).state.$touch()),placeholder:u.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).city.$error&&p(y).city.$errors[0].$message,label:u.$t("customers.city")},{default:c(()=>[s(g,{modelValue:o.city,"onUpdate:modelValue":l[2]||(l[2]=C=>o.city=C),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:p(y).city.$error,onInput:l[3]||(l[3]=C=>p(y).city.$touch()),placeholder:u.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).address_street_1.$error&&p(y).address_street_1.$errors[0].$message,label:u.$t("customers.address")},{default:c(()=>[s(n,{modelValue:o.address_street_1,"onUpdate:modelValue":l[4]||(l[4]=C=>o.address_street_1=C),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:p(y).address_street_1.$error,onInput:l[5]||(l[5]=C=>p(y).address_street_1.$touch()),placeholder:u.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).zip.$error&&p(y).zip.$errors[0].$message,label:u.$t("customers.zip_code")},{default:c(()=>[s(g,{modelValue:o.zip,"onUpdate:modelValue":l[6]||(l[6]=C=>o.zip=C),invalid:p(y).zip.$error,onInput:l[7]||(l[7]=C=>p(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:u.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),a("div",Is,[s(P,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:i},{default:c(()=>[j(v(u.$t("general.cancel")),1)]),_:1}),s(P,{loading:I.value,variant:"primary",type:"submit"},{left:c(C=>[I.value?E("",!0):(r(),M(m,{key:0,name:"SaveIcon",class:G(C.class)},null,8,["class"]))]),default:c(()=>[j(" "+v(u.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},te="Sales Tax",se="MODULE",As={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const _=X(),e=Z(),o=Q(),{t:I}=K(),f=R(!1),d=t,S=k(()=>d.isEdit?d.store[d.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),T=k(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),y=k(()=>d.isEdit?d.store[d.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),D=k(()=>d.isEdit?d.store[d.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),V=k(()=>{if(y.value&&q.value){let n=S.value?d.customer.billing:d.customer.shipping;return{address:W.exports.pick(n,["address_street_1","city","state","zip"]),customer_id:d.customer.id}}else if(D.value&&q.value)return{address:W.exports.pick(address,["address_street_1","city","state","zip"])}}),q=k(()=>{var n,B;if(y.value){let P=S.value?(n=d.customer)==null?void 0:n.billing:(B=d.customer)==null?void 0:B.shipping;return i(P)}else if(D.value)return i(e.selectedCompany.address);return!1});ae(()=>d.customer,(n,B)=>{if(n&&B&&y.value){u(n,B);return}!q.value&&y.value&&n?setTimeout(()=>{l()},500):y.value&&n?m():y.value&&!n&&b()}),xe(()=>{D.value&&(q.value?m():l())});function i(n){return n?n.address_street_1&&n.city&&n.state&&n.zip:!1}function u(n,B){const P=S.value?n.billing:n.shipping,L=S.value?B.billing:B.shipping,C=W.exports.pick(P,["address_street_1","city","state","zip"]),A=W.exports.pick(L,["address_street_1","city","state","zip"]);W.exports.isEqual(C,A)||m()}function l(){var P,L;if(!T.value)return;let n=null,B="";y.value?S.value?(n=(P=d.customer)==null?void 0:P.billing,B=I("settings.taxations.add_billing_address")):(n=(L=d.customer)==null?void 0:L.shipping,B=I("settings.taxations.add_shipping_address")):(n=e.selectedCompany.address,B=I("settings.taxations.add_company_address")),_.openModal({title:B,content:I("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:n,id:y.value?d.customer.id:""})}async function m(){!T.value||(f.value=!0,await o.fetchSalesTax(V.value).then(n=>{g(n.data.data),f.value=!1}).catch(n=>{n.response.data.error&&setTimeout(()=>{l()},500),f.value=!1}))}function g(n){n.tax_type_id=n.id;const B=d.store[d.storeProp].taxes.findIndex(P=>P.name===te&&P.type===se);B>-1?Object.assign(d.store[d.storeProp].taxes[B],n):d.store[d.storeProp].taxes.push(n)}function b(){const n=d.store[d.storeProp].taxes.findIndex(P=>P.name===te&&P.type===se);n>-1&&d.store[d.storeProp].taxes.splice(n,1);let B=o.taxTypes.findIndex(P=>P.name===te&&P.type===se);B>-1&&o.taxTypes.splice(B,1)}return(n,B)=>(r(),M(Ss,{onAddTax:g}))}};export{js as _,qs as a,As as b,Cs as c,Vs as d,Ds as e,Ms as f};
