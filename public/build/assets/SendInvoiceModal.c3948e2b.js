import{I as K,H as X,u as J,a9 as Q,l as W,d as w,K as Y,e as B,p as v,q as h,s as x,v as Z,r as c,o as $,j as V,h as n,b as p,z as f,t as _,a,c as N,x as o,n as ee,g as U}from"./main.b57b9d3d.js";import{u as oe}from"./mail-driver.3bb58eec.js";const te={class:"flex justify-between w-full"},ae={key:0,action:""},re={class:"px-8 py-8 sm:p-6"},se={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},le={key:1},ne={class:"my-6 mx-4 border border-gray-200 relative"},ie=["src"],ue={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},ve={__name:"SendInvoiceModal",emits:["update"],setup(de,{emit:P}){const u=K(),j=X(),z=J(),q=Q();oe();const{t:d}=W();let i=w(!1);const C=w(""),b=w(!1),D=P,G=w(["customer","customerCustom","invoice","invoiceCustom","company"]),r=Y({id:null,from:null,to:null,subject:"New Invoice",body:null}),F=B(()=>u.active&&u.componentName==="SendInvoiceModal"),L=B(()=>u.title),S=B(()=>u.data),R={from:{required:v.withMessage(d("validation.required"),h),email:v.withMessage(d("validation.email_incorrect"),x)},to:{required:v.withMessage(d("validation.required"),h),email:v.withMessage(d("validation.email_incorrect"),x)},subject:{required:v.withMessage(d("validation.required"),h)},body:{required:v.withMessage(d("validation.required"),h)}},t=Z(R,B(()=>r));function T(){b.value=!1}async function A(){let s=await j.fetchBasicMailConfig();r.id=u.id,s.data&&(r.from=s.data.from_mail),S.value&&(r.to=S.value.customer.email),r.body=j.selectedCompanySettings.invoice_mail_body}async function k(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(i.value=!0,!b.value){const m=await q.previewInvoice(r);i.value=!1,b.value=!0;var s=new Blob([m.data],{type:"text/html"});C.value=URL.createObjectURL(s);return}const e=await q.sendInvoice(r);if(i.value=!1,e.data.success)return D("update",u.id),y(),!0}catch(e){console.error(e),i.value=!1,z.showNotification({type:"error",message:d("invoices.something_went_wrong")})}}function y(){u.closeModal(),setTimeout(()=>{t.value.$reset(),b.value=!1,C.value=null},300)}return(s,e)=>{const m=c("BaseIcon"),M=c("BaseInput"),I=c("BaseInputGroup"),E=c("BaseCustomInput"),O=c("BaseInputGrid"),g=c("BaseButton"),H=c("BaseModal");return $(),V(H,{show:F.value,onClose:y,onOpen:A},{header:n(()=>[p("div",te,[f(_(L.value)+" ",1),a(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:y})])]),default:n(()=>[b.value?($(),N("div",le,[p("div",ne,[a(g,{class:"absolute top-4 right-4",disabled:o(i),variant:"primary-outline",onClick:T},{default:n(()=>[a(m,{name:"PencilIcon",class:"h-5 mr-2"}),e[8]||(e[8]=f(" Edit "))]),_:1},8,["disabled"]),p("iframe",{src:C.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ie)]),p("div",ue,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[f(_(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:o(i),disabled:o(i),variant:"primary",type:"button",onClick:e[7]||(e[7]=l=>k())},{default:n(()=>[o(i)?U("",!0):($(),V(m,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),f(" "+_(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):($(),N("form",ae,[p("div",re,[a(O,{layout:"one-column",class:"col-span-7"},{default:n(()=>[a(I,{label:s.$t("general.from"),required:"",error:o(t).from.$error&&o(t).from.$errors[0].$message},{default:n(()=>[a(M,{modelValue:r.from,"onUpdate:modelValue":e[0]||(e[0]=l=>r.from=l),type:"text",invalid:o(t).from.$error,onInput:e[1]||(e[1]=l=>o(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(I,{label:s.$t("general.to"),required:"",error:o(t).to.$error&&o(t).to.$errors[0].$message},{default:n(()=>[a(M,{modelValue:r.to,"onUpdate:modelValue":e[2]||(e[2]=l=>r.to=l),type:"text",invalid:o(t).to.$error,onInput:e[3]||(e[3]=l=>o(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(I,{error:o(t).subject.$error&&o(t).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:n(()=>[a(M,{modelValue:r.subject,"onUpdate:modelValue":e[4]||(e[4]=l=>r.subject=l),type:"text",invalid:o(t).subject.$error,onInput:e[5]||(e[5]=l=>o(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(I,{label:s.$t("general.body"),error:o(t).body.$error&&o(t).body.$errors[0].$message,required:""},{default:n(()=>[a(E,{modelValue:r.body,"onUpdate:modelValue":e[6]||(e[6]=l=>r.body=l),fields:G.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),p("div",se,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[f(_(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:o(i),disabled:o(i),variant:"primary",type:"button",class:"mr-3",onClick:k},{left:n(l=>[o(i)?U("",!0):($(),V(m,{key:0,class:ee(l.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[f(" "+_(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{ve as _};
